<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhangben.backend.mapper.ActivityRateSnapshotMapper">

  <resultMap id="BaseResultMap" type="com.zhangben.backend.model.ActivityRateSnapshot">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="activity_id" jdbcType="INTEGER" property="activityId" />
    <result column="currency_code" jdbcType="VARCHAR" property="currencyCode" />
    <result column="locked_rate" jdbcType="DECIMAL" property="lockedRate" />
    <result column="created_at" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt" />
  </resultMap>

  <select id="selectByActivityAndCurrency" resultMap="BaseResultMap">
    SELECT * FROM activity_rate_snapshots
    WHERE activity_id = #{activityId} AND currency_code = #{currencyCode}
  </select>

  <select id="selectByActivityId" resultMap="BaseResultMap">
    SELECT * FROM activity_rate_snapshots
    WHERE activity_id = #{activityId}
    ORDER BY currency_code
  </select>

  <insert id="insert" parameterType="com.zhangben.backend.model.ActivityRateSnapshot" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO activity_rate_snapshots (activity_id, currency_code, locked_rate)
    VALUES (#{activityId}, #{currencyCode}, #{lockedRate})
  </insert>

  <update id="updateLockedRate">
    UPDATE activity_rate_snapshots
    SET locked_rate = #{lockedRate}
    WHERE activity_id = #{activityId} AND currency_code = #{currencyCode}
  </update>

  <delete id="deleteByActivityId">
    DELETE FROM activity_rate_snapshots WHERE activity_id = #{activityId}
  </delete>

</mapper>
