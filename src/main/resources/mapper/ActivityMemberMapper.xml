<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhangben.backend.mapper.ActivityMemberMapper">

    <insert id="insert">
        INSERT INTO activity_member (activity_id, user_id, role)
        VALUES (#{activityId}, #{userId}, #{role})
    </insert>

    <select id="selectByActivityAndUser" resultType="map">
        SELECT m.*, u.nickname
        FROM activity_member m
        INNER JOIN user u ON m.user_id = u.id
        WHERE m.activity_id = #{activityId} AND m.user_id = #{userId}
    </select>

    <select id="selectByActivityId" resultType="map">
        SELECT m.user_id, u.nickname, m.role, m.joined_at
        FROM activity_member m
        INNER JOIN user u ON m.user_id = u.id
        WHERE m.activity_id = #{activityId}
        ORDER BY m.joined_at
    </select>

    <delete id="delete">
        DELETE FROM activity_member WHERE activity_id = #{activityId} AND user_id = #{userId}
    </delete>

    <delete id="deleteByActivityId">
        DELETE FROM activity_member WHERE activity_id = #{activityId}
    </delete>

    <select id="countByActivityId" resultType="int">
        SELECT COUNT(*) FROM activity_member WHERE activity_id = #{activityId}
    </select>

</mapper>
